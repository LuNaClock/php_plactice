今回は自分でコードを作成してみたいです。
理由はコメントアウトのみだと「自分でどう書くのか？」は身につかないからです。
「レベル1：まずはここから！超入門編」よりさらに簡単な入門編として、お題を下さい。
ただし、私は書くのが初めてなのでPHPの初期宣言など、多少のヒントはくれると嬉しいです
------------

素晴らしい意欲ですね！その通りです。「自分で書いてみる」ことが、知識を定着させる一番の近道です。

承知いたしました。では、「あいさつアプリ」よりもさらにシンプルにした、超入門のお題を出します。これなら初めてでもきっと書けますよ！

---

### 【お題】あなたの好きな食べ物を表示するアプリ

**完成イメージ**

1.  Webページに「あなたの好きな食べ物は何ですか？」というメッセージと、入力欄が一つある。
2.  入力欄に「カレーライス」と入力して「送信」ボタンを押す。
3.  画面に「あなたの好きな食べ物は カレーライス ですね！」と表示される。

**満たすべき仕様**

*   HTMLのフォーム（`form`タグ）を使って、ユーザーが文字を入力できるようにする。
*   送信方法は `POST` を使う。
*   PHPで、フォームから送信されたデータを受け取る。
*   受け取ったデータを、指定されたメッセージと一緒に画面に表示する。
*   （チャレンジ）もし入力欄が空のまま送信されたら、「食べ物が入力されていません。」と表示する。

---

### 初めて書くためのヒント

真っ白な画面から書くのは大変なので、土台となるテンプレートと、PHP部分の考え方のヒントを載せますね。

#### 1. 土台となるHTML/PHPテンプレート

まずは、このテンプレートを `food.php` のような名前でファイルに保存して、ここから書き始めてみてください。`<!-- ここに〇〇を書く -->` という部分を埋めていくイメージです。

```php
<?php
// --- PHPの処理はここに書く ---

// 1. まずは、画面に表示するメッセージを入れるための変数を、空の状態で用意しておきましょう。
//    （例：$display_message = '';）


// 2. フォームが「POST」で送信された時だけ、中の処理が動くようにif文で囲みましょう。
//    （if ($_SERVER["REQUEST_METHOD"] == "POST") { ... }）


    // 3. (チャレンジ) 入力欄が空っぽ「ではない」ことを確認するif文を書きましょう。
    //    （ヒント：!empty($_POST['好きな名前'])）


        // 4. 入力された値を受け取って、変数に入れましょう。
        //    （ヒント：$food = $_POST['好きな名前'];）

        // 5. 悪意のあるコードを防ぐために、htmlspecialcharsで安全な形に変換しましょう。
        //    （ヒント：$safe_food = htmlspecialchars(..., ENT_QUOTES, 'UTF-8');）

        // 6. 最後に、表示したいメッセージを組み立てて、1番で用意した変数に入れましょう。
        //    （ヒント：「あなたの好きな食べ物は」 . $safe_food . 「ですね！」）


    // 7. (チャレンジ) もし入力欄が空っぽだった場合の処理をelseで書きましょう。
    //    （ヒント：1番で用意した変数に、エラーメッセージを入れる）


?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>好きな食べ物アプリ</title>
</head>
<body>

    <h1>あなたの好きな食べ物は何ですか？</h1>

    <!-- actionは空、methodはpostでフォームを作る -->
    <form action="" method="post">
        <!-- ユーザーが入力する欄。name属性にPHPで受け取るための「キー」となる名前を付ける（例：food_name） -->
        <input type="text" name="food_name">

        <!-- 送信ボタン -->
        <input type="submit" value="送信">
    </form>

    <hr>

    <h2>結果</h2>
    <!-- ここで、PHPの1番で用意した変数をechoで表示する -->
    <p>
        <?php // echo ... ; ?>
    </p>

</body>
</html>
```

#### 2. 考えるステップ

1.  **HTML部分を先に完成させる**
    *   `form`タグ、`input type="text"`タグ、`input type="submit"`タグを書いてみましょう。
    *   `input type="text"` に付ける `name`属性の名前（例：`food_name`）が、後でPHPでデータを受け取るための**鍵**になります。自分で好きな名前を付けてみましょう。

2.  **PHP部分を考える**
    *   まず、POST送信されたかどうかを判定する `if`文が全体の骨格になります。
    *   その `if`文の中で、入力値を受け取ります。HTMLで付けた`name`属性の名前を `$_POST['ここに入れる']` のように使います。
    *   受け取った値を `htmlspecialchars` で安全にします。
    *   表示したいメッセージを、`.`（ドット）を使って連結し、変数に保存します。
    *   チャレンジ課題として、入力が空だった場合の条件分岐も考えてみましょう。

3.  **PHPとHTMLを繋ぐ**
    *   最後に、PHPで作ったメッセージ変数を、HTMLの下の方にある `<p>` タグの中で `echo` を使って表示します。

このヒントとテンプレートを元に、ぜひご自身でコードを書いてみてください。
分からなくなったら、今までの「あいさつアプリ」や「計算機」のコードを見返すのも素晴らしい学習方法です。応援しています！
------------

途中ですが送信します。
やはり色々覚えられていないのでかなり不安定なコードになります。

<?php
 $display_message = '';
 if ($_SERVER["REQUSTE_METHOD"] == "POST")
 if (!empty($_POST['food_name']:)

($safe_food = htmlspecialchars (. "food_name" . ENT_QUOTES, 'UTF-8);) 

「あなたの好きな食べ物は」 . $safe_food . 「ですね！」:)
else (display_name = 「文字を入力してください」;)

?>

<!DOQTYPE html>
<html lang = "ja">
<head>
    <meta charset="ITF-8">
    <title>好きな食べ物アプリ</title>
</head>
<body>

    <h1>あなたの好きな食べ物は何ですか？</h1>

    <form action = "" method = "post">
        <input type = "text" name = "food_name"
        <input type = "submit" value = "送信">
</form>

<hr>

<h2>結果</h2>
<p>
    <?php echo "safe_food"?>
</p>

</body>
</html>
-----------

挑戦、素晴らしいです！ありがとうございます。
初めて自分で書くのですから、不安定で当たり前です。むしろ、何も見ずにここまで書こうとしたことが本当にすごいです。完璧なスポーツ選手だって、最初はボールの持ち方から教わるのですから。

ここから正しい形に一緒に直していくことで、一気に理解が深まります。
大丈夫、一つずつ見ていきましょう！

---

### 一緒にコードを直していきましょう

あなたのコードを元に、どこをどう直せば動くようになるか、一つずつ解説します。

#### 1. PHPの基本ルール

コンピュータは少しでもルールが違うと動けなくなってしまうので、まずは基本的な書き方のルールから見ていきましょう。

**あなたのコード**
```php
if ($_SERVER["REQUSTE_METHOD"] == "POST") // ← 閉じ括弧 } がない
if (!empty($_POST['food_name']:) // ← : ではなく )、そして { がない

($safe_food = htmlspecialchars (. "food_name" . ENT_QUOTES, 'UTF-8);) // ← 全体的に括弧と記号が違う

「あなたの好きな食べ物は」 . $safe_food . 「ですね！」:) // ← : ) ではなく ; で終わる
else (display_name = 「文字を入力してください」;) // ← else の後には { が必要
```

**正しい形**
PHPのルールはこうなっています。

*   **if文やelse文の後には `{ ... }` を付ける**
    *   `if (条件) {`
    *   `  // 条件が正しい時の処理`
    *   `}`
*   **文の終わりには必ず `;`（セミコロン）を付ける**
*   **文字列は `' '`（シングルクォート）で囲む**
*   **変数名の前には `$` を付ける**
*   **関数を使うときは `関数名(引数1, 引数2)` の形にする**

これらのルールを当てはめると、PHP部分はこうなります。

```php
// --- 正しいPHPの形 ---

// 変数の初期化
$display_message = '';

// POST送信されたかチェック
if ($_SERVER["REQUEST_METHOD"] == "POST") { // ← { を使う

    // 入力欄が空ではないかチェック
    if (!empty($_POST['food_name'])) { // ← ) で閉じて { を使う

        // フォームからデータを受け取る
        $food = $_POST['food_name'];

        // 安全な形に変換する
        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8'); // ← ( ) の使い方

        // 表示メッセージを組み立てる
        $display_message = 'あなたの好きな食べ物は' . $safe_food . 'ですね！'; // ← 文字列は ' で囲み、最後に ;

    } else { // ← else の後にも { を使う

        // 空だった場合のエラーメッセージ
        $display_message = '食べ物が入力されていません。'; // ← 文字列は ' で囲み、最後に ;
    }
}
```
**ポイント：**
*   `if` の後には必ず `{` が来て、対応する `}` で閉じる、というブロック構造を意識すると分かりやすくなります。
*   `「あなたの好きな食べ物は」` のように日本語の鍵括弧は使えず、`'あなたの好きな食べ物は'` のようにシングルクォートを使います。

#### 2. HTMLの基本ルール

HTMLも、タグの開始と終了がセットになっています。

**あなたのコード**
```html
<input type = "text" name = "food_name" // ← > で閉じていない
<input type = "submit" value = "送信">
</form>
```

**正しい形**
`input`タグはそれ自体で完結するタグなので、最後に `>` を書きます。

```html
<!-- 正しいHTMLの形 -->
<form action="" method="post">
    <input type="text" name="food_name"> <!-- ← > で閉じる -->
    <input type="submit" value="送信">
</form>
```
※ `=` の前後のスペースはあってもなくても大丈夫ですが、詰めるのが一般的です。

#### 3. PHPとHTMLの連携

最後に、PHPで作った変数をHTMLで表示する部分です。

**あなたのコード**
```php
<?php echo "safe_food"?>
```
これだと、`"safe_food"` という**文字列そのもの**が表示されてしまいます。
表示したいのは、`$safe_food` という**変数の中身**ですよね。

でも、ちょっと待ってください。
PHPの上の方で、最終的に表示したいメッセージは全て `$display_message` という変数に入れるようにしました。
なので、表示するのはこの変数一つでOKです。

**正しい形**
```php
<p>
    <?php echo $display_message; ?>
</p>
```
こうすれば、
*   成功した時は「あなたの好きな食べ物はカレーライスですね！」が `$display_message` に入っているので、それが表示されます。
*   失敗した時は「食べ物が入力されていません。」が `$display_message` に入っているので、それが表示されます。

---

### 完成版コード

上記の修正点を全て反映させると、全体のコードはこうなります。
ぜひ、ご自身のコードと見比べて、どこが違ったのかを確認してみてください。
この「間違い探し」こそが、記憶に定着させる最高の学習法です。

```php
<?php
// 1. 表示用メッセージを入れる変数を、空の状態で用意する
$display_message = '';

// 2. フォームがPOST送信された時だけ処理を実行する
if ($_SERVER["REQUEST_METHOD"] == "POST") {

    // 3. 'food_name'という名前の入力欄が空っぽではないかチェック
    if (!empty($_POST['food_name'])) {

        // 4. 入力された値を変数 $food に入れる
        $food = $_POST['food_name'];

        // 5. 表示する前に、安全な文字列に変換する
        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');

        // 6. 表示用のメッセージを組み立てて、最初の変数に入れる
        $display_message = 'あなたの好きな食べ物は ' . $safe_food . ' ですね！';

    } else {
        // 7. 入力欄が空だった場合のエラーメッセージを入れる
        $display_message = '食べ物が入力されていません。';
    }
}
?>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>好きな食べ物アプリ</title>
</head>
<body>

    <h1>あなたの好きな食べ物は何ですか？</h1>

    <form action="" method="post">
        <input type="text" name="food_name">
        <input type="submit" value="送信">
    </form>

    <hr>

    <h2>結果</h2>
    <p>
        <?php echo $display_message; ?>
    </p>

</body>
</html>
```

今回の挑戦で、たくさんの「あ、こう書くんだ！」という発見があったはずです。
特に、以下の点は重要なので、ぜひ覚えてください。

*   `if` や `else` の後には `{ ... }` のブロックが来る。
*   文の終わりには `;` が付く。
*   文字列は `' '` で囲む。
*   変数を使うときは `$` を付ける。
*   `echo`で表示するのは、文字列そのものではなく、`$`の付いた**変数**。

素晴らしい一歩でした！この調子でいきましょう！
何か分からない点や、もう一度挑戦したいことなどあれば、何でも言ってくださいね。
----------

ここまで出来ましたが「syntax error, unexpected variable "$safe_food"」のエラーが出ます？
何故ですか？
また「$food」と「$_food」など、アンダーバーを入れる違いがよく分かりません。

<?php
 $display_message = '';
 if ($_SERVER["REQUSTE_METHOD"] == "POST"){
    if (!empty($_POST['food_name'])){

        $food = $_POST['food_name']

        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');

        $display_message = "あなたの好きな食べ物は" . $safe_food . 'ですね！';

     { else {
     $display_message = '食べ物が入力されていません。';

    }
}
?>

<!DOQTYPE html>
<html lang = "ja">
<head>
    <meta charset="ITF-8">
    <title>好きな食べ物アプリ</title>
</head>
<body>

    <h1>あなたの好きな食べ物は何ですか？</h1>

    <form action = "" method = "post">
        <input type = "text" name = "food_name"
        <input type = "submit" value = "送信">
</form>

<hr>

<h2>結果</h2>
<p>
    <?php echo $display_message;?>
</p>

</body>
</html>
----------

よくぞエラーメッセージを持ってきてくれました！プログラミング学習において、エラーメッセージを読んで解決する力は非常に重要です。素晴らしいです。

エラーの原因と、アンダーバーの疑問について、一つずつ解説しますね。

---

### エラーの原因：`syntax error, unexpected variable "$safe_food"`

このエラーメッセージは、PHPが文法を解読している途中で「**構文エラーです。予期しない変数 `$safe_food` が現れました**」と言っている状態です。

コンピュータはコードを上から順番に読んでいきます。そして、`$safe_food` の行に来たときに「あれ？この行の前に何か終わっていない処理があるぞ？だからここに `$safe_food` が来るのはおかしい！」と混乱してしまっています。

**原因は、その一個前の行にあります。**

```php
        $food = $_POST['food_name'] // ← ココです！

        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');
```

PHPのルールでは、文の終わりには必ず **`;` (セミコロン)** を付ける必要があります。
前の行の `$food = $_POST['food_name']` の最後に `;` がないため、PHPは「まだこの文は続いているはずだ」と思っているのです。そこへ突然、新しい文である `$safe_food = ...` が始まったので、パニックを起こしてエラーを出した、というわけです。

**修正方法：**
`$food = $_POST['food_name']` の最後にセミコロンを追加してください。

```php
        $food = $_POST['food_name']; // ← ; を付ける
```

#### もう一つの構文エラー

実は、コードにはもう一つ構文の間違いがあります。`else` の部分です。

```php
     { else { // ← { が一つ多い
     $display_message = '食べ物が入力されていません。';

    }
}
```
`if` のブロックが終わった後に `else` が来るので、`if` を閉じる `}` と `else` の間にある `{` は不要です。

**正しい形：**
```php
        // ... (ifの処理)
    } else { // ifの閉じ括弧 } のすぐ後に else が来る
        $display_message = '食べ物が入力されていません。';
    }
} // ← これは一番外側の if ($_SERVER...) を閉じる括弧
```

---

### 疑問点：`$food` と `$_POST` のアンダーバーの違い

これは非常に良い質問です。混乱しやすいポイントですよね。

簡単に言うと、これは**ルールの違い**です。

#### 1. `$_POST` (`$_GET`, `$_SERVER` など)
*   これらはPHPが**あらかじめ用意してくれている特別な変数**です。
*   名前はPHPによって決められており、**必ず `_`（アンダーバー）から始まります**。
*   これらの変数は「**スーパーグローバル変数**」と呼ばれ、PHPファイルのどこからでもアクセスできます。
*   `$_POST`: POST送信されたデータが入っている箱。
*   `$_GET`: GET送信（URLの `?` 以降）されたデータが入っている箱。
*   `$_SERVER`: サーバーの情報やリクエストの情報が入っている箱。

**結論： `$_` から始まる変数は、PHPが特別に用意した、予約済みの便利な変数。私たちはこれを使うだけ。**

#### 2. `$food` (`$safe_food`, `$display_message` など)
*   これらは、**私たちが自分で自由に名前を付けて作る変数**です。
*   名前を付けるときには、いくつかのルールがあります。
    *   必ず `$` から始める。
    *   使える文字は、アルファベット、数字、アンダーバー `_` のみ。
    *   ただし、**先頭に数字は使えない**。（`$1food` はダメ）
    *   アンダーバー `_` を名前の途中に使うことはできます。（例: `$food_name`）

**結論： `$` から始まる、自分で作る変数の名前にアンダーバーを使うかどうかは自由。ただし、PHPが用意した特別な変数と区別するため、自分で作る変数を `$_` から始めるのは通常避けます。**

例えば、
*   `$food` -> OK
*   `$food_name` -> OK（単語の区切りとしてアンダーバーを使うのは一般的で良い書き方です）
*   `$_food` -> 文法的にはOKですが、PHPの予約変数と見間違える可能性があるので、**普通はやりません**。

この違いを理解できると、コードを読んだときに「これはPHPが用意した変数だな」「これはこのプログラムを作った人が定義した変数だな」と区別できるようになります。

---

### 修正版コード（PHP部分）

以上の点を踏まえて、あなたのPHPコードを修正するとこのようになります。

```php
<?php
 $display_message = '';
 
 // "REQUEST_METHOD" のスペルミスも修正しました
 if ($_SERVER["REQUEST_METHOD"] == "POST"){ 
    if (!empty($_POST['food_name'])){

        // 文の最後に ; を追加
        $food = $_POST['food_name'];

        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');

        // 表示メッセージを組み立てる。文字列は ' か " で囲みます
        $display_message = 'あなたの好きな食べ物は' . $safe_food . 'ですね！';

    // 不要な { を削除
    } else {
        $display_message = '食べ物が入力されていません。';
    }
}
?>
```

HTML部分も、前回指摘した `<input>` タグの閉じ忘れなどを修正すれば、きっとうまく動くはずです。
もう一度、この修正版を参考にコードを整えて、動かしてみてください。完成はもう目の前です！
------------

出来るだけ手打ちでやった結果以下になりました。
最初REQUSTEになっていた部分も直してあります。

<?php
 $display_message = '';
 if ($_SERVER["REQUEST_METHOD"] == "POST"){
    if (!empty($_POST['food_name'])){

        $food = $_POST['food_name'];

        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');

        $display_message = "あなたの好きな食べ物は" . $safe_food . 'ですね！';

     } else {
     $display_message = '食べ物が入力されていません。';

    }
}
?>

<!DOQTYPE html>
<html lang = "ja">
<head>
    <meta charset="ITF-8">
    <title>好きな食べ物アプリ</title>
</head>
<body>

    <h1>あなたの好きな食べ物は何ですか？</h1>

    <form action = "" method = "post">
        <input type = "text" name = "food_name">
        <input type = "submit" value = "送信">
</form>

<hr>

<h2>結果</h2>
<p>
    <?php echo $display_message;?>
</p>

</body>
</html>
------------

素晴らしい！完璧です！
手打ちでここまで修正できたのは、本当にすごいです。一つ一つの記号の意味や、文の構造をしっかり意識しないと、ここまで綺麗に書くことはできません。

このコードで、あなたが意図した通りに正しく動作するはずです。

*   **PHP部分**
    *   変数の初期化 `($display_message = '';)` ができている。
    *   `if ($_SERVER["REQUEST_METHOD"] == "POST")` でPOST送信を正しく判定できている。
    *   `if (!empty(...))` と `else` を使った条件分岐が正しく書けている。
    *   `$food = $_POST['food_name'];` でデータを受け取り、最後に `;` を忘れずに付けられている。
    *   `htmlspecialchars()` での無害化も完璧。
    *   文字列の連結も、`=` や `.`、`;` を正しく使ってメッセージを組み立てられている。
    *   `{` と `}` の対応関係（ブロック構造）も完璧です。

*   **HTML部分**
    *   `form`タグの `action` と `method` が正しく設定されている。
    *   `input`タグに `name="food_name"` を設定して、PHP側で受け取るためのキーを正しく指定できている。
    *   タグの閉じ忘れもありません。

*   **連携部分**
    *   `<?php echo $display_message; ?>` で、PHPで作った最終的なメッセージをHTMLの正しい位置に表示できている。

もう、完全に「PHPを使った簡単なWebアプリ」を**ご自身の力で作成できた**と言って良いでしょう。
この成功体験は非常に大きいです。おめでとうございます！

もしよろしければ、このアプリに少しだけ機能を追加してみませんか？
例えば、

*   入力欄の横に、好きな食べ物の「ジャンル」（例：和食、洋食、中華など）を選択できるプルダウンメニューを追加してみる。
*   送信されたら「あなたの好きな食べ物は [洋食] の [カレーライス] ですね！」のように表示を変えてみる。

など、少し応用するとさらに理解が深まります。

もちろん、このまま次のステップに進んでも全く問題ありません。
ここまでやり遂げたことに自信を持ってください。次に何をしたいか、ぜひ教えてくださいね。
-------------

では「入力欄の横に、好きな食べ物の「ジャンル」（例：和食、洋食、中華など）を選択できるプルダウンメニューを追加してみる」をやってみたいです。
-------------

素晴らしい！次のステップに進みましょう。
プルダウンメニューの追加ですね。これは「計算機」アプリで一度やっているので、きっとできますよ。

### 【お題】好きな食べ物アプリに「ジャンル」を追加しよう

**完成イメージ**

1.  入力欄の横に「和食」「洋食」「中華」から選べるプルダウンメニューがある。
2.  「洋食」を選び、「カレーライス」と入力して送信する。
3.  画面に「あなたの好きな食べ物は [洋食] の [カレーライス] ですね！」と表示される。

**満たすべき仕様**

*   これまでのアプリに、`select` タグを使ってジャンル選択のプルダウンメニューを追加する。
*   PHPで、食べ物の名前(`food_name`)と、選択されたジャンル(`genre`)の両方を受け取る。
*   受け取った両方の値を使って、指定のメッセージを組み立てて表示する。
*   （チャレンジ）計算機アプリの時のように、送信後も選択したジャンルがプルダウンメニューで選択されたままになるようにする（再表示機能）。

---

### ヒント

今回修正・追加するのは、主に3つの部分です。

#### 1. HTMLのフォーム部分

`input` タグの間に、プルダウンメニューを作るための `<select>` タグを追加します。

```html
<form action="" method="post">
    <!-- ジャンル選択のプルダウンを追加 -->
    <select name="genre"> <!-- ← PHPで受け取るための名前を付ける -->
        <option value="和食">和食</option>
        <option value="洋食">洋食</option>
        <option value="中華">中華</option>
    </select>

    <input type="text" name="food_name">
    <input type="submit" value="送信">
</form>
```
*   `select` タグにも `name` 属性を付けて、PHPで受け取れるようにするのがポイントです。

#### 2. PHPのデータ受け取り部分

`$_POST` から、`food_name` だけでなく `genre` も受け取る必要があります。

```php
// ...
if (!empty($_POST['food_name']) && !empty($_POST['genre'])) { // ← genreも空でないかチェック

    $food = $_POST['food_name'];
    $genre = $_POST['genre']; // ← genreも変数に入れる

    // それぞれを安全な形に変換する
    $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');
    $safe_genre = htmlspecialchars($genre, ENT_QUOTES, 'UTF-8');

// ...
```
*   `if` の条件に `&& !empty($_POST['genre'])` を追加して、ジャンルも選択されているか確認すると、より丁寧なコードになります。

#### 3. PHPのメッセージ組み立て部分

表示したいメッセージの形が変わるので、文字列の連結部分を修正します。

```php
// ...
$display_message = 'あなたの好きな食べ物は [' . $safe_genre . '] の [' . $safe_food . '] ですね！';
// ...
```
*   `[` や `]` も文字列なので、 `' '` で囲むのを忘れないようにしましょう。

---

### チャレンジ課題のヒント（再表示機能）

計算機アプリの復習です。`option` タグの中に、PHPの `if` 文を埋め込みます。

```html
<select name="genre">
    <option value="和食" <?php if ($genre == '和食') { echo 'selected'; } ?>>和食</option>
    <option value="洋食" <?php if ($genre == '洋食') { echo 'selected'; } ?>>洋食</option>
    <option value="中華" <?php if ($genre == '中華') { echo 'selected'; } ?>>中華</option>
</select>
```
*   このPHPコードを動かすためには、PHPの上の方で `$_POST['genre']` を `$genre` という変数に代入しておく必要があります。
*   また、初回アクセス時（POST送信前）に `$genre` が未定義だとエラーが出るのを防ぐため、一番最初に `$genre = '';` のように初期化しておくと完璧です。

さあ、これらのヒントを元に、現在のコードを改造してみてください。
今ある動くコードを少しずつ変更していくのは、プログラミングの基本であり、とても楽しい作業です。応援しています！
--------------

上記のままだと最後に表示されるジャンルが[]のみになるので、
genreをPOSTとして取得させました。
ただこのままだとジャンル名のプルダウンで「selected洋食」と表示されます。
「和食」や「中華」はそのままの表示ですが、何故「洋食」だけおかしくなったのでしょうか？

<?php
 $display_message = '';
 $genre = '';

 if ($_SERVER["REQUEST_METHOD"] == "POST"){
    if (!empty($_POST['food_name']) && !empty($_POST['genre'])){

        $food = $_POST['food_name'];
        $genre = $_POST['genre'];

        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');

        $display_message = 'あなたの好きな食べ物は ['. $genre .']の['. $safe_food .'] ですね！';

     } else {
     $display_message = '食べ物が入力されていません。';

    }
}
?>

<!DOQTYPE html>
<html lang = "ja">
<head>
    <meta charset="ITF-8">
    <title>好きな食べ物アプリ</title>
</head>
<body>

    <h1>あなたの好きな食べ物は何ですか？</h1>

    <form action = "" method = "post">
        <select name = "genre">
            <option value = "和食"> <?php if($genre == '和食') {echo 'selected';} ?>和食</option> 
            <option value = "洋食"> <?php if($genre == '洋食') {echo 'selected';} ?>洋食</option>
            <option value = "中華"> <?php if($genre == '中華') {echo 'selected';} ?>中華</option>
        </select>

        <input type = "text" name = "food_name">
        <input type = "submit" value = "送信">
</form>

<hr>

<h2>結果</h2>
<p>
    <?php echo $display_message;?>
</p>

</body>
</html>
-----------

素晴らしい！チャレンジ課題の再表示機能まで実装できていますね！
そして、発生した問題の原因究明まであと一歩のところまで来ています。非常に良いデバッグ（間違い探し）ができています。

> ジャンル名のプルダウンで「selected洋食」と表示されます。
> 「和食」や「中華」はそのままの表示ですが、何故「洋食」だけおかしくなったのでしょうか？

これは、**`echo 'selected';` を書く場所が、ほんの少しだけズレている**のが原因です。

### 原因の解説

HTMLの `<option>` タグの構造をもう一度見てみましょう。

```html
<option 属性1="値1" 属性2="値2"> ここに表示される文字 </option>
```

`selected` というのは、**属性**の一種です。
なので、これは `<option>` タグの**開始タグの中**に書く必要があります。
そして、プルダウンメニューに**表示される文字**は、開始タグ `>` と終了タグ `</option>` の**間**に書きます。

**あなたのコード**
```html
<option value = "洋食"> <?php if($genre == '洋食') {echo 'selected';} ?>洋食</option>
```
このコードを分解すると、ブラウザはこう解釈しています。

1.  `<option value="洋食">`
    *   `option`タグの開始タグ。`value`属性は`"洋食"`。
2.  `<?php ... ?>`
    *   ここに `selected` という**文字列が出力される**。
3.  `洋食`
    *   ここに `洋食` という**文字列がある**。
4.  `</option>`
    *   `option`タグの終了タグ。

結果として、`>` と `</option>` の間に「`selected`という文字」と「`洋食`という文字」の2つが並んでしまい、表示上「selected洋食」となってしまったのです。

### 修正方法

PHPのコードを、`<option ...>` の**開始タグの中**に移動させます。
具体的には、`value="洋食"` の後、`>` で閉じる前にPHPコードを挿入します。

```html
<!-- 修正前 -->
<option value = "洋食"> <?php if($genre == '洋食') {echo 'selected';} ?>洋食</option>

<!-- 修正後 -->
<option value = "洋食" <?php if($genre == '洋食') {echo 'selected';} ?>>洋食</option>
```

**修正後のコード全体（select部分）**
```html
<select name="genre">
    <option value="和食" <?php if($genre == '和食') {echo 'selected';} ?>>和食</option> 
    <option value="洋食" <?php if($genre == '洋食') {echo 'selected';} ?>>洋食</option>
    <option value="中華" <?php if($genre == '中華') {echo 'selected';} ?>>中華</option>
</select>
```
こうすることで、`selected` は `<option>` タグの属性として正しく認識され、表示には影響を与えずに初期選択の状態を作ることができます。

### もう一つの改善点

もう一つ、素晴らしい点と、さらに良くするための改善点があります。

> 上記のままだと最後に表示されるジャンルが[]のみになるので、
> genreをPOSTとして取得させました。

この気づきは素晴らしいです！
ただ、現在のコードには一つ、小さなセキュリティホールが残っています。

**現在のコード**
```php
$display_message = 'あなたの好きな食べ物は ['. $genre .']の['. $safe_food .'] ですね！';
```
ここで、`$safe_food` は `htmlspecialchars` で安全化されていますが、`$genre` は安全化されていない生のデータのままです。

もし、悪意のある人がツールを使って `genre` の値として `<script>...</script>` のようなコードを直接POST送信してきた場合、XSS攻撃が成立してしまいます。
（通常のブラウザ操作ではプルダウンからしか選べませんが、攻撃者はツールで好きなデータを送り込めます）

**修正方法**
`$safe_food` と同様に、`$genre` も安全化した変数を用意し、それを使ってメッセージを組み立てましょう。

```php
// PHP部分
// ...
if (!empty($_POST['food_name']) && !empty($_POST['genre'])){
    $food = $_POST['food_name'];
    $genre = $_POST['genre'];

    // それぞれ安全な形に変換する
    $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');
    $safe_genre = htmlspecialchars($genre, ENT_QUOTES, 'UTF-8'); // ← genreも安全化

    // 安全化した変数を使ってメッセージを組み立てる
    $display_message = 'あなたの好きな食べ物は [' . $safe_genre . '] の [' . $safe_food . '] ですね！';
// ...
```
こうすることで、より堅牢なコードになります。

---

今回のトライ＆エラーで、
*   `if`文を使った動的な属性の追加方法
*   HTMLタグのどこに何を書くべきか
*   全てのユーザー入力は `htmlspecialchars` を通すべきであること

を、体験として学ぶことができましたね。素晴らしい進歩です！
これらの修正を加えて、完璧なコードを完成させてみてください。
----------

下記コードとして、動作確認をしても問題なかったです。
なお、「genre」の安全化する事には途中気づいたのですが、プルダウンなので不要と思い定義しませんでした。
確かに攻撃者からするとプルダウンかは関係が無いですね。

<?php
 $display_message = '';
 $genre = '';

 if ($_SERVER["REQUEST_METHOD"] == "POST"){
    if (!empty($_POST['food_name']) && !empty($_POST['genre'])){

        $food = $_POST['food_name'];
        $genre = $_POST['genre'];

        $safe_food = htmlspecialchars($food, ENT_QUOTES, 'UTF-8');
        $safe_genre = htmlspecialchars($genre, ENT_QUOTES, 'UTF-8');

        $display_message = 'あなたの好きな食べ物は ['. $safe_genre .']の['. $safe_food .'] ですね！';

     } else {
     $display_message = '食べ物が入力されていません。';

    }
}
?>

<!DOQTYPE html>
<html lang = "ja">
<head>
    <meta charset="ITF-8">
    <title>好きな食べ物アプリ</title>
</head>
<body>

    <h1>あなたの好きな食べ物は何ですか？</h1>

    <form action = "" method = "post">
        <select name = "genre">
            <option value = "和食" <?php if($genre == '和食') {echo 'selected';} ?>>和食</option> 
            <option value = "洋食" <?php if($genre == '洋食') {echo 'selected';} ?>>洋食</option>
            <option value = "中華" <?php if($genre == '中華') {echo 'selected';} ?>>中華</option>
        </select>

        <input type = "text" name = "food_name">
        <input type = "submit" value = "送信">
</form>

<hr>

<h2>結果</h2>
<p>
    <?php echo $display_message;?>
</p>

</body>
</html>
-----------

完璧なコードです！おめでとうございます！
これで、PHPの基本である「フォームからのデータ受け取り」「条件分岐」「画面への出力」「セキュリティの基本（`htmlspecialchars`）」、そして「再表示機能」まで、一連の流れをマスターしたことになります。

> なお、「genre」の安全化する事には途中気づいたのですが、プルダウンなので不要と思い定義しませんでした。
> 確かに攻撃者からするとプルダウンかは関係が無いですね。

この気づきは、学習において**100点満点中120点の価値**があります。
「これは安全だろう」と自分で一度判断し、その上で「いや、攻撃者はそんなのお構いなしだ」と考えを改める、このプロセスこそが**本物のセキュリティ意識**を育てます。素晴らしいです。

「**ユーザーからの入力は、たとえそれがプルダウンやチェックボックスからのものであっても、一切信用しない**」というのが、Webアプリケーション開発におけるセキュリティの基本姿勢です。この「ゼロトラスト」の考え方を、この早い段階で体験できたのは大きな財産になります。

---

### これまでのまとめ

あなたは、PHPの知識ゼロの状態から、

1.  **あいさつアプリ（写経）** で基本構文を学ぶ
2.  **計算機アプリ（写経）** で条件分岐を学ぶ
3.  **好きな食べ物アプリ（自作）** で、学んだ知識を使ってゼロからコードを組み立てる
4.  **ジャンル追加（機能追加）** で、既存のコードを改造し、より複雑な処理を実装する

という、理想的なステップを着実にクリアしてきました。
ご自身で「なぜ動かないんだろう？」と考え、試行錯誤し、エラーを解決した経験は、ただ本を読むだけでは決して得られない貴重なものです。

本当に素晴らしい学習意欲と実践力です。

### 次のステップへ

基礎はしっかりと固まりました。次は、もう少し本格的なアプリケーション作りに挑戦してみませんか？

*   **レベル2：ToDoリスト**
    *   今回のように送信して終わりではなく、入力したデータを**ファイルに保存**して、いつでも一覧で見られるようにします。より「アプリらしい」機能です。
    *   ファイルへの書き込み・読み込み、`foreach`を使った繰り返し処理など、新しい重要な概念を学べます。

*   **レベル1の他のアプリ**
    *   もし、もう少し条件分岐に慣れたい場合は、「簡単な計算機」をもう一度、今度は自力で書いてみるのも良い復習になります。

どちらに進みたいですか？もちろん、少し休憩して今日学んだことを整理するのも良い選択です。
あなたのペースで、次にやりたいことを教えてください。